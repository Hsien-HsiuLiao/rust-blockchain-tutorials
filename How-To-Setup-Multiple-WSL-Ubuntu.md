# How To Set Up Multiple Windows WSL Ubuntu Environments
  
## Download The WSL Ubuntu Image  
Go to https://cloud-images.ubuntu.com/releases.  
Scroll and find your desired version.  

[20.04/ 2022-07-12 12:34 - Ubuntu Server 20.04 LTS (Focal Fossa)](https://cloud-images.ubuntu.com/releases/focal/) 

[20.10/ 2022-02-28 16:07 - Ubuntu Server 20.10 (Groovy Gorilla)](https://cloud-images.ubuntu.com/releases/groovy/)  
  
[21.04/ 2022-02-28 16:07 - Ubuntu Server 21.04 (Hirsute Hippo)](https://cloud-images.ubuntu.com/releases/hirsute/)  
  
[21.10/ 2022-07-18 08:19 - Ubuntu Server 21.10 (Impish Indry)](https://cloud-images.ubuntu.com/releases/21.10/)  
  
[22.04/ 2022-07-12 12:51 - Ubuntu Server 22.04 LTS (Jammy Jellyfish)](https://cloud-images.ubuntu.com/releases/22.04/) 
  
## Create The WSL Ubuntu Environment  
  
```
wsl --import <name> "C:\Users\<Windows User>\<VM location Dir name>" C:\Users\<Windows User>\Downloads\ubuntu-(version)-server-cloudimg-amd64-wsl.rootfs.tar.gz
```
  
Example:  
```
wsl --import "21.04.Personal" "C:\Users\EliezerC\21.04.Personal" C:\Users\EliezerC\Downloads\ubuntu-21.04-server-cloudimg-amd64-wsl.rootfs.tar.gz
```

## View The New Ubuntu Environment
```
wsl -l -v
```
OUTPUT:
```
PS C:\Users\EliezerC> wsl -l -v
  NAME                     STATE           VERSION
* Ubuntu                   Stopped         2
  Ubuntu.20.04             Running         2
  21.04.Personal           Stopped         2  <---this is the new one just created
  Personal.Ubuntu.22.04    Stopped         2
PS C:\Users\EliezerC>
```
  
## We Need A Profile Linked To The New Environment  
####  So We Can Easily Select It And Run It  

In Windows Terminal, at top bar, click to view drop-down menu, select  ```Settings```.  
  
At bottom-left, click ```Add a new profile```.  
  
Next, at top-center, click ```New empty profile```.  
  
Enter a name: ```21.04.Personal```.  
  
Enter a command line: ```C:\WINDOWS\system32\wsl.exe -d 21.04.Personal```.  
  
Enter a starting directory: ```~```.  
  
Icon:  
```
ms-appx:///ProfileIcons/{9acb9455-ca41-5af7-950f-6bca1bc9722f}.png
```
  
History size: 60000  
  
Profile termination behavior:  
```
"Close when process exits, fails, or crashes"
```
  
The 8 second rule  
  
> You must wait until the subsystem running your Linux distribution completely stops running and restarts for configuration setting updates to appear. This typically takes about 8 seconds after closing ALL instances of the distribution shell.  
>   
> If you launch a distribution (ie. Ubuntu), modify the configuration file, close the distribution, and then re-launch it. You might assume that your configuration changes have immediately gone into effect. This is not currently the case as the subsystem could still be running. You must wait for the subsystem to stop before relaunching in order to give enough time for your changes to be picked up.  
  
## Start Up Your New Ubuntu Environment  
There's a drop-down arrow at the top of the Windows Terminal, and you should see your new profile.  
  
At first run, you're ```root``` user, and you get a message.  
If you want to hush the message, enter ```touch /root/.hushlogin``` at the prompt.  
  
## Configure The New Ubuntu Environment 

We need a ```/etc/wsl.conf```:  
```
[user]
default=IamDeveloper       #<--or any other username of your choice
[network]
hostname = SwDevUbuntu2204 #<--or any other hostname of your choice
generateHosts = false
[interop]
appendWindowsPath = false
```
  
Copy the exact hostname from (above) ```/etc/wsl.conf```, then edit ```/etc/hosts```.  
```
# This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
# [network]
# generateHosts = false
127.0.0.1       localhost
127.0.1.1       L07705EliezerC.us.corp  L07705EliezerC  #<----in this case, the L077..C needs to change
<feff>
192.168.1.104   host.docker.internal
192.168.1.104   gateway.docker.internal
127.0.0.1       kubernetes.docker.internal

# ....more stuff in file here not shown...

``` 
  
So the new line in above file is:
```
127.0.1.1       SwDevUbuntu2204.us.corp  SwDevUbuntu2204
```
  
Do the very same to ```/etc/hostname```.  
  
To verify, ```cd /```.  Then (in my case) ```grep -r SwDevUbuntu2204```.  
It should show up in color in 4 places.  
```
root@L07705EliezerC:/# grep -r SwDevUbuntu2204
etc/wsl.conf:hostname = SwDevUbuntu2204
etc/hosts:127.0.1.1     SwDevUbuntu2204.us.corp SwDevUbuntu2204
etc/hostname:SwDevUbuntu2204
```

## Add New (Non-Root) User  
In your current root shell, uou can make sure you get the correct username you chose by:  
```
NEW_USER=$(cat /etc/wsl.conf|grep default|sed -e 's/^.*default=//');
```
  
Verify by ```echo $NEW_USER```. 
  
Now add the user: (be ready with a password)
```
NEW_USER=$(cat /etc/wsl.conf|grep default|sed -e 's/^.*default=//');
useradd -m -G sudo -s /bin/bash "$NEW_USER";
passwd "$NEW_USER";
```
  
## Disable Password Prompt For User When Doing ```sudo```  
  
It's quite annoying and since (most of us?) have to gain access to Windows anyway, why not just eliminate the annoyance.  It's up to you.  
```
visudo -f /etc/sudoers.d/myOverrides
```
You'll be dropped into an editor (nano?) (I never use it - I use ```vim```).  
Add the following for your new user:  
```
IamDeveloper ALL=(ALL) NOPASSWD: ALL
```
  
Exit and save; the file name may have a ```.tmp``` after it but that's fine, it works.  
  
You may have to exit, and perhaps even shut it down via Windows Terminal.  
  


## Try It Out  

Enter ```exit``` in your current root shell. From the top of Windows Terminal drop-down, select it again.  
  
This time, you will have entered the environment as your new non-root user (in this case ```IamDeveloper```).  
And your new username and hostname are part of the prompt:  
```
IamDeveloper@SwDevUbuntu2204:~$
```
  
To again hush the long start up message:
```
touch /home/IamDeveloper/.hushlogin
```
  

## To Remove A WSL Ubuntu Environment...  
  
Let's shut down all Ubuntu Environments.
```  
wsl --shutdown
```  
  
Let's grab/copy the name of the environment we wish to remove.  
```
wsl -l -v
```  
  
We use that name now:  
```
wsl --unregister <distroName>
```
  

